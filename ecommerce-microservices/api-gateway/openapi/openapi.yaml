openapi: 3.0.0
paths:
  /auth/login:
    post:
      operationId: AuthGateway_login
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginDto"
      responses:
        "201":
          description: ""
      tags: &a1
        - AuthGateway
  /auth/register:
    post:
      operationId: AuthGateway_register
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterDto"
      responses:
        "201":
          description: ""
      tags: *a1
  /auth/refresh:
    post:
      operationId: AuthGateway_refresh
      parameters: []
      responses:
        "201":
          description: ""
      tags: *a1
  /auth/logout:
    post:
      operationId: AuthGateway_logout
      parameters: []
      responses:
        "201":
          description: ""
      tags: *a1
  /auth/google:
    get:
      operationId: AuthGateway_googleAuth
      parameters: []
      responses:
        "200":
          description: ""
      tags: *a1
  /auth/google/callback:
    get:
      operationId: AuthGateway_googleAuthCallback
      parameters: []
      responses:
        "200":
          description: ""
      tags: *a1
  /auth/facebook:
    get:
      operationId: AuthGateway_facebookAuth
      parameters: []
      responses:
        "200":
          description: ""
      tags: *a1
  /auth/facebook/callback:
    get:
      operationId: AuthGateway_facebookAuthCallback
      parameters: []
      responses:
        "200":
          description: ""
      tags: *a1
  /auth/login-sms:
    post:
      operationId: AuthGateway_sendOtp
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SendOtpDto"
      responses:
        "201":
          description: ""
      tags: *a1
  /auth/verify-sms:
    post:
      operationId: AuthGateway_verifyOtp
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyOtpDto"
      responses:
        "201":
          description: ""
      tags: *a1
  /users:
    post:
      operationId: UserGateway_create
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserDto"
      responses:
        "201":
          description: ""
      summary: Tạo người dùng mới
      tags: &a2
        - UserGateway
    get:
      operationId: UserGateway_findAll
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
        - description: Từ khóa tìm kiếm (username, email hoặc phone)
          required: false
          name: search
          in: query
          schema:
            example: john
            type: string
        - description: Lọc theo vai trò người dùng (USER, SELLER, ADMIN)
          required: false
          name: role
          in: query
          schema:
            example: customer
            type: string
        - description: Lọc theo trạng thái hoạt động
          required: false
          name: isActive
          in: query
          schema:
            example: "true"
            type: string
        - description: Số trang muốn lấy (mặc định 1)
          required: false
          name: page
          in: query
          schema:
            example: "1"
            type: string
        - description: Số item mỗi trang (mặc định 10)
          required: false
          name: limit
          in: query
          schema:
            example: "10"
            type: string
        - description: 'Sort theo field, dấu "-" để sort DESC. Ví dụ: "-createdAt,username"'
          required: false
          name: sort
          in: query
          schema:
            example: -createdAt,username
            type: string
      responses:
        "200":
          description: ""
      summary: Lấy danh sách người dùng (search/filter/pagination)
      tags: *a2
  /users/{id}:
    get:
      operationId: UserGateway_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            example: 67467bd24993cd524ff1a120
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      summary: Lấy thông tin một người dùng theo ID
      tags: *a2
    put:
      operationId: UserGateway_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            example: 67467bd24993cd524ff1a120
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserDto"
      responses:
        "200":
          description: ""
      summary: Cập nhật thông tin người dùng
      tags: *a2
    delete:
      operationId: UserGateway_deactivate
      parameters:
        - name: id
          required: true
          in: path
          schema:
            example: 67467bd24993cd524ff1a120
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      summary: Vô hiệu hóa / deactivate người dùng
      tags: *a2
  /products/seller:
    get:
      operationId: ProductGateway_findAllOfSeller
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProductDto"
      summary: Lấy tất cả sản phẩm thuộc seller hiện tại
      tags: &a3
        - Products
  /products/seller/{id}:
    get:
      operationId: ProductGateway_findOneOfSeller
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductDto"
      summary: Lấy sản phẩm thuộc seller hiện tại theo ID
      tags: *a3
  /products:
    post:
      operationId: ProductGateway_create
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProductDto"
      responses:
        "201":
          description: Product created
      summary: Tạo sản phẩm mới
      tags: *a3
    get:
      operationId: ProductGateway_findAll
      parameters: []
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProductDto"
      summary: Lấy danh sách sản phẩm (filter + search)
      tags: *a3
  /products/{id}:
    get:
      operationId: ProductGateway_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductDto"
      summary: Lấy chi tiết một sản phẩm
      tags: *a3
    patch:
      operationId: ProductGateway_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProductDto"
      responses:
        "200":
          description: ""
      summary: Cập nhật thông tin sản phẩm
      tags: *a3
    delete:
      operationId: ProductGateway_remove
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: Product deleted
      summary: Xoá mềm sản phẩm (chỉ owner mới được xoá)
      tags: *a3
  /products/search:
    post:
      operationId: ProductGateway_search
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SimpleSearchDto"
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProductDto"
      summary: Tìm kiếm sản phẩm nâng cao
      tags: *a3
  /products/{id}/stock:
    patch:
      operationId: ProductGateway_updateStock
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateStockDto"
      responses:
        "200":
          description: ""
      summary: Cập nhật tồn kho (nhập / giảm hàng)
      tags: *a3
  /cart:
    get:
      operationId: CartGateway_getCarts
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: &a4
        - CartGateway
    post:
      operationId: CartGateway_addItem
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: *a4
  /cart/update:
    patch:
      operationId: CartGateway_updateItem
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a4
  /cart/product:
    delete:
      operationId: CartGateway_removeItem
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a4
  /cart/productQuantity:
    patch:
      operationId: CartGateway_updateQuantity
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a4
  /cart/order:
    post:
      operationId: CartGateway_createOrder
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: *a4
  /reviews:
    post:
      operationId: ReviewGateway_create
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateReviewDto"
      responses:
        "201":
          description: ""
      security:
        - bearer: []
      summary: Tạo review mới cho sản phẩm
      tags: &a5
        - ReviewGateway
    get:
      operationId: ReviewGateway_findAll
      parameters:
        - name: rating
          required: false
          in: query
          description: Lọc theo rating 1–5
          schema:
            example: 5
        - name: productId
          required: false
          in: query
          schema:
            example: 67467bd24993cd524ff1a120
      responses:
        "200":
          description: ""
      summary: Lấy danh sách tất cả review (search, filter)
      tags: *a5
  /reviews/{id}:
    get:
      operationId: ReviewGateway_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            example: 67467bd24993cd524ff1a120
            type: string
      responses:
        "200":
          description: ""
      summary: Lấy chi tiết 1 review theo ID
      tags: *a5
    patch:
      operationId: ReviewGateway_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            example: 67467bd24993cd524ff1a120
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateReviewDto"
      responses:
        "200":
          description: ""
      security:
        - bearer: []
      summary: Cập nhật 1 review theo ID
      tags: *a5
    delete:
      operationId: ReviewGateway_remove
      parameters:
        - name: id
          required: true
          in: path
          schema:
            example: 67467bd24993cd524ff1a120
            type: string
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      security:
        - bearer: []
      summary: Xoá review
      tags: *a5
  /media/upload:
    post:
      operationId: MediaGateway_uploadMedia
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags:
        - MediaGateway
  /seller/orders:
    get:
      operationId: SellerAnalyticsGateway_getOrders
      parameters: []
      responses:
        "200":
          description: ""
      tags: &a6
        - SellerAnalyticsGateway
  /seller/orders/{id}/confirm:
    put:
      operationId: SellerAnalyticsGateway_confirmOrder
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a6
  /seller/orders/{id}/reject:
    put:
      operationId: SellerAnalyticsGateway_rejectOrder
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a6
  /analytics/revenue:
    get:
      operationId: SellerAnalyticsGateway_getRevenue
      parameters:
        - name: type
          required: true
          in: query
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a6
  /orders:
    post:
      operationId: OrderGateway_create
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: &a7
        - OrderGateway
  /orders/seller:
    get:
      operationId: OrderGateway_getCart
      parameters:
        - name: authorization
          required: true
          in: header
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a7
info:
  title: Click2Buy - API Gateway
  description: API Gateway for Click2Buy microservices.
  version: "1.0"
  contact: {}
tags: []
servers: []
components:
  securitySchemes:
    bearer:
      scheme: bearer
      bearerFormat: JWT
      type: http
  schemas:
    LoginDto:
      type: object
      properties:
        username:
          type: string
          description: Tên đăng nhập của người dùng
          example: john_doe
        password:
          type: string
          description: Mật khẩu của người dùng
          example: "123456"
          minLength: 6
      required:
        - username
        - password
    RegisterDto:
      type: object
      properties:
        username:
          type: string
          description: Tên đăng nhập của người dùng
          example: john_doe
        email:
          type: string
          description: Email người dùng
          example: john@gmail.com
        role:
          type: string
          enum:
            - USER
            - SELLER
            - ADMIN
          description: Vai trò của tài khoản (USER, SELLER, ADMIN)
          example: USER
        password:
          type: string
          minLength: 6
          description: Mật khẩu plaintext — backend sẽ tự hash thành passwordHash
          example: "123456"
        phone:
          type: string
          description: Số điện thoại người dùng
          example: "0987654321"
        avatar:
          type: string
          description: URL avatar đại diện của người dùng
          example: https://cdn.example.com/avatar/john.png
      required:
        - username
        - email
        - role
        - password
    SendOtpDto:
      type: object
      properties: {}
    VerifyOtpDto:
      type: object
      properties: {}
    CreateUserDto:
      type: object
      properties:
        username:
          type: string
          description: Tên đăng nhập của người dùng
          example: john_doe
        email:
          type: string
          description: Email người dùng
          example: john@example.com
        password:
          type: string
          description: Mật khẩu plaintext — server sẽ tự hash
          example: "123456"
          minLength: 6
        phone:
          type: string
          description: Số điện thoại của người dùng
          example: "0987654321"
        avatar:
          type: string
          description: Ảnh đại diện của người dùng
          example: https://cdn.example.com/avatar/user.png
      required:
        - username
        - email
        - password
    UpdateUserDto:
      type: object
      properties:
        password:
          type: string
          description: Mật khẩu mới (tùy chọn). Nếu gửi thì phải ≥ 6 ký tự.
          example: newpassword123
          minLength: 6
    WarehouseAddress:
      type: object
      properties:
        line1:
          type: string
        line2:
          type: string
        city:
          type: string
        province:
          type: string
        country:
          type: string
        postalCode:
          type: string
      required:
        - line1
        - city
    ProductDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        price:
          type: number
        salePrice:
          type: number
        isActive:
          type: boolean
        brand:
          type: string
        condition:
          type: string
          enum:
            - new
            - used
          description: Tình trạng sản phẩm
        categoryIds:
          type: array
          items:
            type: string
        tags:
          type: array
          items:
            type: string
        images:
          type: array
          items:
            type: string
        attributes:
          type: object
          description: "Thông tin tuỳ chỉnh (ví dụ: màu sắc, kích thước)"
        variants:
          type: object
          description: "Biến thể sản phẩm (ví dụ: S/M/L, màu sắc…) "
        ratingAvg:
          type: number
          default: 0
        warehouseAddress:
          $ref: "#/components/schemas/WarehouseAddress"
        createdAt:
          format: date-time
          type: string
        updatedAt:
          format: date-time
          type: string
      required:
        - id
        - name
        - price
        - isActive
        - brand
        - condition
        - createdAt
        - updatedAt
    CreateProductDto:
      type: object
      properties:
        name:
          type: string
          example: iPhone 15 Pro Max
        description:
          type: string
          example: Điện thoại cao cấp 2025
        price:
          type: number
          example: 29990000
        salePrice:
          type: number
          example: 27990000
        stock:
          type: number
          example: 10
        brand:
          type: string
          example: Apple
        condition:
          type: string
          enum:
            - new
            - used
          example: new
        categoryIds:
          example:
            - cat123
            - cat456
          type: array
          items:
            type: string
        tags:
          example:
            - smartphone
            - apple
          type: array
          items:
            type: string
        images:
          example:
            - https://img.com/a.jpg
          type: array
          items:
            type: string
        attributes:
          type: object
          example:
            color: black
            storage: 256GB
        variants:
          type: object
          example:
            variantKey: value
        warehouseAddress:
          $ref: "#/components/schemas/WarehouseAddress"
      required:
        - name
        - price
        - brand
    SimpleSearchDto:
      type: object
      properties:
        keyword:
          type: string
          example: iphone
          description: Từ khóa tìm kiếm sản phẩm
      required:
        - keyword
    UpdateStockDto:
      type: object
      properties:
        amount:
          type: number
          example: 5
          description: Số lượng điều chỉnh. >= 0 là nhập thêm, < 0 là giảm
      required:
        - amount
    CreateReviewDto:
      type: object
      properties:
        productId:
          type: string
          description: ID của sản phẩm cần đánh giá (Mongo ObjectId)
          example: 67467bd24993cd524ff1a120
        rating:
          type: number
          description: Điểm rating từ 1 đến 5
          example: 5
          minimum: 1
          maximum: 5
        comment:
          type: string
          description: Bình luận của người dùng (không bắt buộc)
          example: Sản phẩm rất tốt, giao nhanh.
      required:
        - productId
        - rating
    UpdateReviewDto:
      type: object
      properties:
        rating:
          type: number
          description: Điểm review (1 – 5).
          example: 4
          minimum: 1
          maximum: 5
        comment:
          type: string
          description: Nội dung bình luận của người dùng.
          example: Giao hàng nhanh, sản phẩm rất đẹp.
        isApproved:
          type: boolean
          description: Trạng thái phê duyệt review bởi admin (true = duyệt, false = từ
            chối).
          example: true
        images:
          description: Danh sách URL hình ảnh người dùng upload cho review.
          example:
            - https://cdn.example.com/reviews/img1.jpg
            - https://cdn.example.com/reviews/img2.jpg
          type: array
          items:
            type: string
